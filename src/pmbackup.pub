NBW Publication Source File
(C)2015 NeoSoft Corp.
Title=Pale Moon backup tool
Author=Moonchild
Language=US
NeoBookVer=5.80
ScreenColors=16777216
ScreenWidth=640
ScreenHeight=450
BkndColor=0
ScreenAutoSize=Yes
LinkColor=16711680
WindowStyle=0
WindowOrder=0
WindowPos=0
WindowProps=28
BiDiMode=0
UseUpdateTimer=Yes
ReturnTime=60
StartupAction=.first run?¶FileExists "[PubDir]7za.exe" "[found]"¶If "[found]" "<>" "True"¶  ExtractFile "[Embedded]7za.exe" "[PubDir]7za.exe"¶EndIf¶¶.check Pale Moon path¶¶SystemInfo "%APPDATA%" "[AppData]"¶SetVar "[PMPath]" "[AppData]\Moonchild Productions\Pale Moon"¶FolderExists "[PMPath]" "[foldercheck]"¶If "[foldercheck]" "<>" "True"¶  AlertBox "Error" "The default Pale Moon profile path was not found!|This application requires a desktop installation of Pale Moon.|It will not work with a portable installation!||The program will now exit."¶  Exit "" ""¶EndIf¶¶FolderExists "[PMPath]\Profiles" "[foldercheck]"¶If "[foldercheck]" "<>" "True"¶  AlertBox "Error" "No Pale Moon profiles were found!|This application requires a desktop installation of Pale Moon.|It will not work with custom profile paths!||The program will now exit."¶  Exit "" ""¶EndIf¶¶.get settings¶¶hpwIniRead "[PubDir]pmbackup.ini" "Options" "Compress" "yes" "[Pref_Compress]"¶hpwIniRead "[PubDir]pmbackup.ini" "Options" "Encrypt" "no" "[Pref_Password]"¶hpwIniRead "[PubDir]pmbackup.ini" "Options" "Overwrite" "yes" "[Pref_Overwrite]"¶hpwIniRead "[PubDir]pmbackup.ini" "Options" "CMD" "no" "[Pref_ShowCMD]"¶hpwIniRead "[PubDir]pmbackup.ini" "Paths" "Backup" "{default}" "[backup-path]"¶¶If "[Pref_Compress]" "=" "yes"¶  SetVar "[CB_Compress]" "Checked"¶else¶  SetVar "[CB_Compress]" ""¶EndIf¶If "[Pref_Password]" "=" "yes"¶  SetVar "[CB_Password]" "Checked"¶else¶  SetVar "[CB_Password]" ""¶EndIf¶If "[Pref_Overwrite]" "=" "yes"¶  SetVar "[CB_Overwrite]" "Checked"¶else¶  SetVar "[CB_Overwrite]" ""¶EndIf¶If "[Pref_ShowCMD]" "=" "yes"¶  SetVar "[CB_ShowCMD]" "Checked"¶else¶  SetVar "[CB_ShowCMD]" ""¶EndIf¶¶If "[backup-path]" "=" "{default}"¶  SetVar "[backup-path]" "[MyDocuments]PM backup"¶EndIf¶¶FolderExists "[backup-path]" "[foldercheck]"¶If "[foldercheck]" "<>" "True"¶  CreateFolder "[backup-path]"¶EndIf¶¶.gosub read backups¶GoSub "ReadBackups"¶
ShutdownAction=If "[CB_Compress]" "=" "Checked"¶  SetVar "[Pref_Compress]" "yes"¶else¶  SetVar "[Pref_Compress]" "no"¶EndIf¶If "[CB_Password]" "=" "Checked"¶  SetVar "[Pref_Password]" "yes"¶else¶  SetVar "[Pref_Password]" "no"¶EndIf¶If "[CB_Overwrite]" "=" "Checked"¶  SetVar "[Pref_Overwrite]" "yes"¶else¶  SetVar "[Pref_Overwrite]" "no"¶EndIf¶If "[CB_ShowCMD]" "=" "Checked"¶  SetVar "[Pref_ShowCMD]" "yes"¶else¶  SetVar "[Pref_ShowCMD]" "no"¶EndIf¶¶hpwIniWrite "[PubDir]pmbackup.ini" "Options" "Compress" "[Pref_Compress]"¶hpwIniWrite "[PubDir]pmbackup.ini" "Options" "Encrypt" "[Pref_Password]"¶hpwIniWrite "[PubDir]pmbackup.ini" "Options" "Overwrite" "[Pref_Overwrite]"¶hpwIniWrite "[PubDir]pmbackup.ini" "Options" "CMD" "[Pref_ShowCMD]"¶hpwIniWrite "[PubDir]pmbackup.ini" "Paths" "Backup" "[backup-path]"¶
SubroutineAction=:ReadBackups¶FileList "[backup-path]\*.pmbackup" "Files" "[backuplist]"¶Return¶¶:ValidatePassword¶SetVar "[LegalCharacters]" "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"¶StrLen "[Password]" "[PassLen]"¶If "[PassLen]" ">" "0"¶  Loop "1" "[PassLen]" "[i]"¶    SubStr "[Password]" "[i]" "1" "[PassChar]"¶    SearchStr "[PassChar]" "[LegalCharacters]" "[found]" "CaseSensitive"¶    If "[found]" "=" "0"¶      .illegal char. Clear password and exit sub¶      SetVar "[Password]" ""¶      Return¶    EndIf¶  EndLoop¶Return¶
ShapeTransColor=536870912
Icon=pmbackup.ico
SplashProps=3
CompressPub=Yes
CompileType=0
MediaType=0
FilesIncluded=1
FontsIncluded=2
FontsToCompile=|
CopyExternalFiles=No
SetupBaggage=E:\WORK\Neobook\pmbackup\7za.exe¶
SetupMedia=3
SetupInstDir=C:\Program Files\PMBackup
SetupTitle=Pale Moon profile backup tool
SetupColors=12615808|12632256|16777215
Variables=[#34]¶[7zPassword]¶[action]¶[AppData]¶[BackupCount]¶[backuplist]¶[backup-path]¶[Backupselected]¶[CB_Compress]¶[CB_Overwrite]¶[CB_Password]¶[CB_ShowCMD]¶[compression-level]¶[foldercheck]¶[found]¶[i]¶[LegalCharacters]¶[PassChar]¶[PassLen]¶[Password]¶[PMPath]¶[PMRunning]¶[Pref_Compress]¶[Pref_Overwrite]¶[Pref_Password]¶[Pref_ShowCMD]¶
VersionProduct=PM Backup
VersionDesc=Pale Moon profile backup tool
VersionCompany=Moonchild Productions
VersionCopyright=© 2012,2013 M.C. Straver
VersionMajor=1
VersionMinor=1
VersionRelease=1
VersionBuild=417
VersionAutoInc=Yes
ReqExLevel=1
EmbeddedFiles=:"7za.exe=7za.exe"
CustomFontName=Arial
CustomFontSize=9
CustomFontStyle=0
CustomCharset=1
CacheSize=30
ExtractOp=132
L_OK=OK
L_CANCEL=Cancel
L_YES=Yes
L_NO=No
L_CLOSE=Close
L_ERRORTITLE=Error
L_FINDTITLE=Find
L_FINDPROMPT=Find &What
L_FINDFIRST=&Find First
L_FINDNEXT=Find &Next
L_FINDERROR=Search text not found.
L_PWORDTITLE=Password required
L_PWORDMSG=Before continuing, you must first|enter the correct password.
L_PWORDPROMPT=&Password:
L_PWORDERROR=That's not the right password!
L_MEDIAERROR=In order to play this type of file you must install|the appropriate multimedia hardware and/or|software.
L_INTERNETERROR=Unable to locate Internet Browser software.
L_ABORTFUNCTION=Do you want to cancel this function?
L_EXTRACTERROR=This file could not be extracted and cannot be played.
L_INSTDIRPROMPT=Please enter the drive and directory where you would like this program to be installed. To accept the default drive and directory, simply press Enter.
L_INSTFOLDERPROMPT=Do you wish to create a program folder?
L_INSTRUNPROMPT=Do you want to run
L_INSTDISKPROMPT=Please insert disk #
L_INSTDISKERROR=That's not the correct disk, try again.
L_INSTGENERROR=The installation has terminated.
L_INSTEXITPROMPT=Do you really want to cancel the installation?
L_INSTWINTITLE=Setup
L_INSTPROGTITLE=Extracting Files...
L_SENDEMAIL=Sending Mail...
L_MAILSERVER=Please enter the name of your outgoing email server:
L_COPY=Copy to Clipboard
L_SELECTALL=Select All
L_DONWLOADFILE=Downloading: %s
L_PLEASEWAIT=Please wait...
TrayMenuBegin
MenuName=TrayOpen
MenuText=Open
MenuState=3
MenuKey=0
MenuAction=SetVar "[WindowState]" "Normal"¶
MenuName=TrayExit
MenuText=Exit
MenuState=3
MenuKey=0
MenuAction=Exit "" ""¶
MenuEnd
MasterPage
NewPage=Main()
PageStyle=0
PageColor=-16777201
PageGradient1=16711680
PageGradient2=255
PageGradientDir=1
WallpaperStyle=0
EffectSpeed=0
ObjectType=3
Name=setpath
X=20
Y=90
W=150
H=30
Anchor=0
Text=Set backup path...
Hint=Set the path where backups are stored.
Align=2
ImageStyle=0
XPTheme=Yes
ObjAction=FolderBox "Select a path:" "[backup-path]"¶GoSub "ReadBackups"¶
LineColor=0
LineWidth=1
LineStyle=0
FillColor=-16777201
FillPattern=0
Font=Arial
FontSize=10
FontStyle=0
FontCharset=1
TextColor=0
TabOrder=1
ObjectType=8
Name=Title
X=0
Y=0
W=640
H=40
Anchor=0
Font=Arial
FontSize=10
FontStyle=0
FontCharset=1
TextColor=-16777193
Text={\rtf1\ansi\deff0\deftab254{\fonttbl{\f0\fnil\fcharset1 Arial;}}{\colortbl\red0\green0\blue0;\red255\green0\blue0;\red0\green128\blue0;\red0\green0\blue255;\red255\green255\blue0;\red255\green0\blue255;\red128\green0\blue128;\red128\green0\blue0;\red0\green255\blue0;\red0\green255\blue255;\red0\green128\blue128;\red0\green0\blue128;\red255\green255\blue255;\red192\green192\blue192;\red128\green128\blue128;\red0\green0\blue0;\red0\green0\blue0;}\paperw12240\paperh15840\margl1440\margr1440\margt1440\margb1440\margh720\margf720{\*\pnseclvl1\pnucrm\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{.}}}¶{\*\pnseclvl2\pnucltr\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{.}}}¶{\*\pnseclvl3\pndec\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{.}}}¶{\*\pnseclvl4\pnlcltr\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{)}}}¶{\*\pnseclvl5\pndec\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl6\pnlcltr\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl7\pnlcrm\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl8\pnlcltr\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl9\pndec\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶\endnhere\sectdefaultcl{\pard{\qc\li0\fi0\ri0\sb0\sl\sa0 \plain\f0\fs36\cf0 Pale Moon profile backup tool}}¶}
HMargin=0
VMargin=4
LineColor=0
LineWidth=0
LineStyle=0
FillColor=-16777192
FillPattern=0
Enabled=No
TabOrder=2
ObjectType=8
Name=Text2
X=180
Y=90
W=450
H=30
Anchor=0
Font=Arial
FontSize=12
FontStyle=0
FontCharset=1
TextColor=-16777193
Text={\rtf1\ansi\deff0\deftab254{\fonttbl{\f0\fnil\fcharset1 Arial;}}{\colortbl\red0\green0\blue0;\red255\green0\blue0;\red0\green128\blue0;\red0\green0\blue255;\red255\green255\blue0;\red255\green0\blue255;\red128\green0\blue128;\red128\green0\blue0;\red0\green255\blue0;\red0\green255\blue255;\red0\green128\blue128;\red0\green0\blue128;\red255\green255\blue255;\red192\green192\blue192;\red128\green128\blue128;\red0\green0\blue0;\red0\green0\blue0;}\paperw12240\paperh15840\margl1440\margr1440\margt1440\margb1440\margh720\margf720{\*\pnseclvl1\pnucrm\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{.}}}¶{\*\pnseclvl2\pnucltr\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{.}}}¶{\*\pnseclvl3\pndec\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{.}}}¶{\*\pnseclvl4\pnlcltr\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{)}}}¶{\*\pnseclvl5\pndec\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl6\pnlcltr\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl7\pnlcrm\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl8\pnlcltr\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl9\pndec\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶\endnhere\sectdefaultcl{\pard{\ql\li0\fi0\ri0\sb0\sl\sa0 \plain\f0\fs24\cf0 [backup-path]}}¶}
HMargin=0
VMargin=4
LineColor=0
LineWidth=0
LineStyle=0
FillColor=-16777192
FillPattern=1
Enabled=No
TabOrder=3
ObjectType=10
Name=Backuplist
X=20
Y=160
W=230
H=270
Anchor=0
Text=[backuplist]
Hint=List of stored profile backups
VarName=[Backupselected]
VarType=0
Sorted=Yes
XPTheme=Yes
LineColor=0
LineWidth=1
LineStyle=0
FillColor=-16777212
FillPattern=1
Font=Arial
FontSize=12
FontStyle=0
FontCharset=1
TextColor=-16777209
TabOrder=4
ObjectType=8
Name=Text3
X=20
Y=130
W=230
H=30
Anchor=0
Font=Arial
FontSize=12
FontStyle=0
FontCharset=1
TextColor=-16777209
Text={\rtf1\ansi\deff0\deftab254{\fonttbl{\f0\fnil\fcharset1 Arial;}}{\colortbl\red0\green0\blue0;\red255\green0\blue0;\red0\green128\blue0;\red0\green0\blue255;\red255\green255\blue0;\red255\green0\blue255;\red128\green0\blue128;\red128\green0\blue0;\red0\green255\blue0;\red0\green255\blue255;\red0\green128\blue128;\red0\green0\blue128;\red255\green255\blue255;\red192\green192\blue192;\red128\green128\blue128;\red0\green0\blue0;\red0\green0\blue0;}\paperw12240\paperh15840\margl1440\margr1440\margt1440\margb1440\margh720\margf720{\*\pnseclvl1\pnucrm\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{.}}}¶{\*\pnseclvl2\pnucltr\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{.}}}¶{\*\pnseclvl3\pndec\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{.}}}¶{\*\pnseclvl4\pnlcltr\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{)}}}¶{\*\pnseclvl5\pndec\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl6\pnlcltr\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl7\pnlcrm\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl8\pnlcltr\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl9\pndec\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶\endnhere\sectdefaultcl{\pard{\ql\li0\fi0\ri0\sb0\sl\sa0 \plain\f0\fs24\cf0 Backups:}}¶}
HMargin=0
VMargin=4
LineColor=0
LineWidth=0
LineStyle=0
FillColor=-16777212
FillPattern=1
Enabled=No
TabOrder=5
ObjectType=3
Name=OptionsButton
X=20
Y=50
W=150
H=30
Anchor=0
Text=Options...
Hint=Set miscellaneous program options.
Align=2
ImageStyle=0
XPTheme=Yes
ObjAction=CustomWindow "" "-1" "-1" "OptionsGroup" "NoBorder+Exclusive+NoCloseBtn"¶
LineColor=0
LineWidth=0
LineStyle=0
FillColor=-16777201
FillPattern=1
FillMode=Yes
Font=Arial
FontSize=10
FontStyle=0
FontCharset=1
TextColor=-16777198
TabOrder=6
ObjectType=20
Name=OptionsGroup
X=-350
Y=25
W=300
H=300
Anchor=0
TabOrder=13
GroupBegin
ObjectType=5
Name=OptionsDialog
X=0
Y=0
W=300
H=300
Anchor=0
LineColor=0
LineWidth=1
LineStyle=0
FillColor=12632256
FillPattern=0
FillMode=Yes
TabOrder=0
ObjectType=8
Name=Text4
X=10
Y=10
W=280
H=30
Anchor=0
Font=Arial
FontSize=14
FontStyle=0
FontCharset=1
TextColor=-16777198
Text={\rtf1\ansi\deff0\deftab254{\fonttbl{\f0\fnil\fcharset1 Arial;}}{\colortbl\red0\green0\blue0;\red255\green0\blue0;\red0\green128\blue0;\red0\green0\blue255;\red255\green255\blue0;\red255\green0\blue255;\red128\green0\blue128;\red128\green0\blue0;\red0\green255\blue0;\red0\green255\blue255;\red0\green128\blue128;\red0\green0\blue128;\red255\green255\blue255;\red192\green192\blue192;\red128\green128\blue128;\red0\green0\blue0;\red0\green0\blue0;}\paperw12240\paperh15840\margl1440\margr1440\margt1440\margb1440\margh720\margf720{\*\pnseclvl1\pnucrm\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{.}}}¶{\*\pnseclvl2\pnucltr\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{.}}}¶{\*\pnseclvl3\pndec\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{.}}}¶{\*\pnseclvl4\pnlcltr\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{)}}}¶{\*\pnseclvl5\pndec\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl6\pnlcltr\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl7\pnlcrm\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl8\pnlcltr\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl9\pndec\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶\endnhere\sectdefaultcl{\pard{\qc\li0\fi0\ri0\sb0\sl\sa0 \plain\f0\fs28\cf0 Options}}¶}
HMargin=0
VMargin=2
LineColor=0
LineWidth=0
LineStyle=0
FillColor=16766409
FillPattern=0
FillMode=Yes
TabOrder=1
ObjectType=12
Name=CB_Compress
X=20
Y=55
W=260
H=20
Anchor=0
Text=Compress backups
Align=1
VarName=[CB_Compress]
InitState=1
LineColor=0
LineWidth=0
LineStyle=0
FillColor=16777161
FillPattern=1
FillMode=Yes
Font=Arial
FontSize=10
FontStyle=0
FontCharset=1
TextColor=0
TabOrder=2
ObjectType=12
Name=CB_Password
X=20
Y=75
W=260
H=20
Anchor=0
Text=Password protect backups
Align=1
VarName=[CB_Password]
InitState=0
LineColor=0
LineWidth=0
LineStyle=0
FillColor=16777161
FillPattern=1
FillMode=Yes
Font=Arial
FontSize=10
FontStyle=0
FontCharset=1
TextColor=8421504
Enabled=No
TabOrder=3
ObjectType=12
Name=CB_Overwrite
X=20
Y=95
W=260
H=20
Anchor=0
Text=Overwrite backups
Hint=Overwrite backups of the same date
Align=1
VarName=[CB_Overwrite]
InitState=1
LineColor=0
LineWidth=0
LineStyle=0
FillColor=16777161
FillPattern=1
FillMode=Yes
Font=Arial
FontSize=10
FontStyle=0
FontCharset=1
TextColor=0
TabOrder=4
ObjectType=3
Name=PushButton3
X=100
Y=250
W=100
H=30
Anchor=0
Text=OK
Align=2
ImageStyle=0
XPTheme=Yes
ObjAction=CloseCustomWindow "OptionsGroup"¶
LineColor=0
LineWidth=0
LineStyle=0
FillColor=16777161
FillPattern=1
FillMode=Yes
Font=Arial
FontSize=10
FontStyle=0
FontCharset=1
TextColor=0
TabOrder=5
ObjectType=12
Name=CB_ShowCMD
X=20
Y=115
W=260
H=20
Anchor=0
Text=Show command window
Align=1
VarName=[CB_ShowCMD]
InitState=0
LineColor=0
LineWidth=0
LineStyle=0
FillColor=16777161
FillPattern=1
FillMode=Yes
Font=Arial
FontSize=10
FontStyle=0
FontCharset=1
TextColor=0
TabOrder=6
GroupEnd
ObjectType=3
Name=BackupButton
X=300
Y=190
W=310
H=60
Anchor=0
Text=Backup
Align=2
ImageStyle=0
XPTheme=Yes
ObjAction=IsAppRunning "palemoon.exe" "[PMRunning]"¶If "[PMRunning]" "=" "True"¶  MessageBox "Warning!" "Pale Moon was found running. |Creating a backup while the browser is running may lead to incomplete or corrupt data|in the backup. You should close the browser before making a backup.||What do you want to do?" "Make a backup anyway|Cancel" "[action]"¶  If "[action]" "<>" "1"¶  .cancel or no choice¶    GotoLine "cancelbackup"¶  EndIf¶EndIf¶.go ahead and backup¶SetVar "[7zPassword]" ""¶GotoLine "skippassword"¶.password¶If "[CB_Password]" "=" "Checked"¶  :askpassword¶  InputBox "Password requested" "Please enter the password to use for the backup.|Note: passwords are case-sensitive!|(Only letters and numbers allowed, no special characters)" "[Password]"¶  Gosub "ValidatePassword"¶  if "[Password]" "=" ""¶    MessageBox "Error" "No password entered or invalid characters in password!|Passwords may only contain A-Z, a-z and 0-9.|No spaces, underscores or special characters allowed." "Input a new password|Cancel the backup" "[action]"¶    If "[action]" "=" "1"¶      GotoLine "askpassword"¶    Else¶      GotoLine "cancelbackup"¶    EndIf¶  EndIf¶  SetVar "[7zPassword]" "-p[Password]"¶Else¶  SetVar "[7zPassword]" ""¶EndIf¶¶:skippassword¶¶.compression¶If "[CB_Compress]" "=" "Checked"¶  SetVar "[compression-level]" "5"¶Else¶  SetVar "[compression-level]" "0"¶EndIf¶¶.add leading zeroes¶DefineVar "[MN]" "String" "" "Local" "0[MonthNum]"¶StrLen "[MN]" "[L]"¶If "[L]" "=" "3"¶  StrDel "[MN]" "1" "1" "[MN]"¶EndIf¶DefineVar "[DN]" "String" "" "Local" "0[DayNum]"¶StrLen "[DN]" "[L]"¶If "[L]" "=" "3"¶  StrDel "[DN]" "1" "1" "[DN]"¶EndIf¶¶.get free backupcount if not overwriting¶SetVar "[BackupCount]" "0"¶DefineVar "[BackupCountS]" "String" "" "Local" "0[BackupCount]"¶If "[CB_Overwrite]" "<>" "Checked"¶  FileExists "[backup-path]\[Year]_[MN]_[DN]_[BackupCountS].pmbackup" "[found]"¶  While "[found]" "=" "True"¶    Math "[BackupCount]+1" "0" "[BackupCount]"¶    .format backup count¶    If "[BackupCount]" "<" "10"¶      SetVar "[BackupCountS]" "0[BackupCount]"¶    Else¶      SetVar "[BackupCountS]" "[BackupCount]"¶    EndIf¶    .check¶    FileExists "[backup-path]\[Year]_[MN]_[DN]_[BackupCountS].pmbackup" "[found]"¶  EndWhile¶EndIf¶.working window¶CustomWindow "" "-1" "-1" "Working" "NoBorder+NoCloseBtn"¶.go go go!¶If "[CB_ShowCMD]" "=" "Checked"¶  Run "[PubDir]7za.exe" "a -t7z [#34][backup-path]\[Year]_[MN]_[DN]_[BackupCountS].pmbackup[#34] [#34][PMPath]\*.*[#34] -mx[compression-level] -r [7zPassword]" "Wait" "" ""¶Else¶  Run "[PubDir]7za.exe" "a -t7z [#34][backup-path]\[Year]_[MN]_[DN]_[BackupCountS].pmbackup[#34] [#34][PMPath]\*.*[#34] -mx[compression-level] -r [7zPassword]" "Wait+Hidden" "" ""¶EndIf¶.hide working window¶CloseCustomWindow "Working"¶:cancelbackup¶SetVar "[Password]" ""¶GoSub "ReadBackups"¶
LineColor=0
LineWidth=1
LineStyle=0
FillColor=-16777201
FillPattern=0
Font=Arial
FontSize=24
FontStyle=0
FontCharset=1
TextColor=-16777198
TabOrder=7
ObjectType=3
Name=PushButton5
X=300
Y=270
W=310
H=60
Anchor=0
Text=Restore
Align=2
ImageStyle=0
XPTheme=Yes
ObjAction=.no selection¶If "[Backupselected]" "=" ""¶  AlertBox "Please select a backup" "Please make sure to select a backup to restore|from the list of backups before clicking the|''Restore'' button.||If your backups are located in a different folder,|select the folder with ''Set backup path...'' first."¶  GotoLine "cancelrestore"¶EndIf¶¶.incorrect selection - list outdated¶FileExists "[backup-path]\[Backupselected]" "[found]"¶If "[found]" "<>" "True"¶  GoSub "ReadBackups"¶  GotoLine "cancelrestore"¶EndIf¶¶:checkrunning¶IsAppRunning "palemoon.exe" "[PMRunning]"¶If "[PMRunning]" "=" "True"¶  MessageBox "Warning!" "Pale Moon was found running. |Restoring a backup while the browser is running is not possible.|You should close the browser before restoring a backup.||What do you want to do?" "        Retry        |        Cancel        " "[action]"¶  If "[action]" "=" "1"¶    GotoLine "checkrunning"¶  Else¶    .cancel or no choice¶    GotoLine "cancelrestore"¶  EndIf¶EndIf¶¶.go ahead and restore¶SetVar "[7zPassword]" ""¶GotoLine "skippassword"¶¶.Quick check for CRC with blank pw -> fails = password needed¶Run "[PubDir]7za.exe" "t -y -p [#34][backup-path]\[Backupselected][#34] localstore.rdf" "Wait+Hidden" "" "[7zAppID]"¶AlertBox "debug" "[7zAppID]|[7zAppID.ExitCode]"¶¶If "[7zAppID.ExitCode]" "<>" "0"¶.Ask password¶  :askpassword¶  InputBox "Password-protected backup" "Please enter the password you used for the backup." "[Password]"¶  Gosub "ValidatePassword"¶  if "[Password]" "=" ""¶    MessageBox "Error" "No password entered or invalid characters in password!" "Input a new password|Cancel the restore" "[action]"¶    If "[action]" "=" "1"¶      GotoLine "askpassword"¶    Else¶      GotoLine "cancelrestore"¶    EndIf¶  EndIf¶  SetVar "[7zPassword]" "-p[Password]"¶  .verify entered password¶  Run "[PubDir]7za.exe" "t -y [7zPassword] [#34][backup-path]\[Backupselected][#34] localstore.rdf" "Wait+Hidden" "" "[7zAppID]"¶  If "[7zAppID.ExitCode]" "<>" "0"¶    MessageBox "Error" "Password incorrect or damaged backup!" "Input a new password|Cancel the restore" "[action]"¶    If "[action]" "=" "1"¶      GotoLine "askpassword"¶    Else¶      GotoLine "cancelrestore"¶    EndIf¶  EndIf¶Else¶  SetVar "[7zPassword]" ""¶EndIf¶¶:skippassword¶¶.working window¶CustomWindow "" "-1" "-1" "Working" "NoBorder+NoCloseBtn"¶.go go go!¶If "[CB_ShowCMD]" "=" "Checked"¶  Run "[PubDir]7za.exe" "x [#34][backup-path]\[Backupselected][#34] -o[#34][PMPath][#34] -y [7zPassword]" "Wait" "" ""¶Else¶  Run "[PubDir]7za.exe" "x [#34][backup-path]\[Backupselected][#34] -o[#34][PMPath][#34] -y [7zPassword]" "Wait+Hidden" "" ""¶EndIf¶.hide working window¶CloseCustomWindow "Working"¶:cancelrestore¶SetVar "[Password]" ""¶
LineColor=0
LineWidth=1
LineStyle=0
FillColor=-16777201
FillPattern=0
Font=Arial
FontSize=24
FontStyle=0
FontCharset=1
TextColor=-16777198
TabOrder=8
ObjectType=3
Name=PushButton6
X=370
Y=370
W=180
H=40
Anchor=0
Text=Exit
Align=2
ImageStyle=0
XPTheme=Yes
ObjAction=Exit "" ""¶
LineColor=0
LineWidth=1
LineStyle=0
FillColor=-16777201
FillPattern=0
Font=Arial
FontSize=12
FontStyle=0
FontCharset=1
TextColor=-16777198
TabOrder=9
ObjectType=3
Name=PushButton7
X=220
Y=130
W=30
H=30
Anchor=0
Align=2
ImageStyle=2
UpImage=folderopen.ico
UpTransColor=536870911
DownTransColor=536870912
OverTransColor=536870912
BevelWidth=0
ObjAction=Run "explorer" "[backup-path]" "Normal" "ReadBackups" ""¶
LineColor=0
LineWidth=0
LineStyle=0
FillColor=16777161
FillPattern=1
FillMode=Yes
Font=Arial
FontSize=10
FontStyle=0
FontCharset=1
TextColor=0
TabOrder=10
ObjectType=3
Name=PushButton8
X=190
Y=130
W=30
H=30
Anchor=0
Align=2
ImageStyle=2
UpImage=refresh.png
UpTransColor=536870911
DownTransColor=536870912
OverTransColor=536870912
BevelWidth=0
ObjAction=GoSub "ReadBackups"¶
LineColor=0
LineWidth=0
LineStyle=0
FillColor=16777161
FillPattern=1
FillMode=Yes
Font=Arial
FontSize=10
FontStyle=0
FontCharset=1
TextColor=0
TabOrder=11
ObjectType=8
Name=VersionText
X=570
Y=430
W=60
H=20
Anchor=0
Font=Arial
FontSize=8
FontStyle=0
FontCharset=1
TextColor=8421504
Text={\rtf1\ansi\deff0\deftab254{\fonttbl{\f0\fnil\fcharset1 Arial;}}{\colortbl\red0\green0\blue0;\red255\green0\blue0;\red0\green128\blue0;\red0\green0\blue255;\red255\green255\blue0;\red255\green0\blue255;\red128\green0\blue128;\red128\green0\blue0;\red0\green255\blue0;\red0\green255\blue255;\red0\green128\blue128;\red0\green0\blue128;\red255\green255\blue255;\red192\green192\blue192;\red128\green128\blue128;\red0\green0\blue0;\red0\green0\blue0;}\paperw12240\paperh15840\margl1440\margr1440\margt1440\margb1440\margh720\margf720{\*\pnseclvl1\pnucrm\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{.}}}¶{\*\pnseclvl2\pnucltr\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{.}}}¶{\*\pnseclvl3\pndec\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{.}}}¶{\*\pnseclvl4\pnlcltr\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{)}}}¶{\*\pnseclvl5\pndec\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl6\pnlcltr\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl7\pnlcrm\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl8\pnlcltr\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl9\pndec\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶\endnhere\sectdefaultcl{\pard{\qr\li0\fi0\ri0\sb0\sl\sa0 \plain\f0\fs16\cf0 v[PubVersion]}}¶}
HMargin=0
VMargin=0
LineColor=0
LineWidth=0
LineStyle=0
FillColor=16777161
FillPattern=1
FillMode=Yes
TabOrder=12
ObjectType=20
Name=Working
X=-340
Y=340
W=280
H=140
Anchor=0
TabOrder=14
GroupBegin
ObjectType=5
Name=Rectangle2
X=0
Y=0
W=280
H=140
Anchor=0
LineColor=0
LineWidth=1
LineStyle=0
FillColor=16312544
FillPattern=0
FillMode=Yes
TabOrder=0
ObjectType=8
Name=Text6
X=20
Y=30
W=240
H=40
Anchor=0
Font=Arial
FontSize=16
FontStyle=0
FontCharset=1
TextColor=0
Text={\rtf1\ansi\deff0\deftab254{\fonttbl{\f0\fnil\fcharset1 Arial;}}{\colortbl\red0\green0\blue0;\red255\green0\blue0;\red0\green128\blue0;\red0\green0\blue255;\red255\green255\blue0;\red255\green0\blue255;\red128\green0\blue128;\red128\green0\blue0;\red0\green255\blue0;\red0\green255\blue255;\red0\green128\blue128;\red0\green0\blue128;\red255\green255\blue255;\red192\green192\blue192;\red128\green128\blue128;\red0\green0\blue0;\red0\green0\blue0;}\paperw12240\paperh15840\margl1440\margr1440\margt1440\margb1440\margh720\margf720{\*\pnseclvl1\pnucrm\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{.}}}¶{\*\pnseclvl2\pnucltr\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{.}}}¶{\*\pnseclvl3\pndec\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{.}}}¶{\*\pnseclvl4\pnlcltr\pnstart1\pnhang\pnindent720{\pntxtb}{\pntxta{)}}}¶{\*\pnseclvl5\pndec\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl6\pnlcltr\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl7\pnlcrm\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl8\pnlcltr\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶{\*\pnseclvl9\pndec\pnstart1\pnhang\pnindent720{\pntxtb{(}}{\pntxta{)}}}¶\endnhere\sectdefaultcl{\pard{\qc\li0\fi0\ri0\sb0\sl\sa0 \plain\f0\fs32\cf0 Working, please wait...}}¶}
HMargin=0
VMargin=0
LineColor=0
LineWidth=0
LineStyle=0
FillColor=12632256
FillPattern=1
FillMode=Yes
TabOrder=1
ObjectType=19
Name=AnimatedGIF1
X=30
Y=70
W=220
H=19
Anchor=0
LoopTimes=0
FileName=throbber.gif
LineColor=0
LineWidth=0
LineStyle=0
FillColor=12632256
FillPattern=1
FillMode=Yes
Font=MS Sans Serif
FontSize=8
FontStyle=0
FontCharset=1
TextColor=-16777208
TabOrder=2
GroupEnd
